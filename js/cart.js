"use strict";var _createClass=function(){function n(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,a){return e&&n(t.prototype,e),a&&n(t,a),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var login=getCookie("login");login||(localStorage.setItem("url",location.href),location.href="../html/dl.html");var Cart=function(){function a(t,e){_classCallCheck(this,a),this.ele=$(t),this.username=e,this.init()}return _createClass(a,[{key:"init",value:function(){var a=this;this.all=document.querySelector(".allCheck"),this.getData(),this.ele.click(function(e){a.id=$(e.target).attr("idx"),"singleCheck"==e.target.className&&(a.data.forEach(function(t){t.productId==a.id&&(t.is_select=e.target.checked)}),a.caculation()),"allCheck"==e.target.className&&(a.data.forEach(function(t){t.is_select=e.target.checked}),a.renderCart()),"add"==e.target.className&&a.increasement(),"reduce"==e.target.className&&a.decrease(),e.target.classList.contains("del")&&(a.remove(a.id),1==a.data.length&&(a.all.checked=!1,a.all.disabled=!0)),"settlement"==e.target.className&&(a.data.filter(function(t){return 1==t.is_select}).forEach(function(t){a.remove(t.productId)}),a.all.checked&&(a.all.checked=!1,a.all.disabled=!0))}),this.username&&$(".askLogin").text(this.username+"已登录")}},{key:"getData",value:function(){$.ajax({url:"../data/getCartData.php",method:"post",data:{username:this.username},success:function(t){this.data=JSON.parse(t),console.log(this.data),"empty"==this.data.code?alert(this.data.msg):this.data.forEach(function(t){t.is_select=!1}),this.renderCart()},error:function(t){console.log(t)},context:this})}},{key:"renderCart",value:function(){this.caculation();var e="";this.data.forEach(function(t){e+='<tr class="cart_goods">\n            <td class="son1">\n                <input type="checkbox" class="singleCheck" idx="'+t.productId+'" '+(t.is_select?"checked":"")+'>\n                <figure>\n                    <a href="./xiangqing.html?id='+t.productId+'">\n                        <img src="'+t.cartImg+'" alt="">\n                    </a>\n                    <h3>\n                        <a href="./xiangqing.html?id='+t.productId+'">'+t.productName+'</a>\n                    </h3>\n                </figure>\n            </td>\n            <td class="son2" style="color:#e4393c;">\n                ￥<span>'+t.salePrice+'</span>\n            </td>\n            <td class="son3">\n                <span class="reduce" idx="'+t.productId+'">-</span>\n                <input type="text" value="'+t.num+'" class="count">\n                <span class="add" idx="'+t.productId+'">+</span>\n            </td>\n            <td class="son4">\n                <span class="glyphicon glyphicon-remove del" idx="'+t.productId+'" aria-hidden="true"></span>\n            </td>\n        </tr>'}),$("tbody").html(e)}},{key:"caculation",value:function(){$(".cartHead").html(this.data.length),0==this.data.length&&(this.all.checked=!1,this.all.disabled=!0),this.selectData=this.data.filter(function(t){return 1==t.is_select}),$(".footQty").text(this.selectData.length);var t=this.data.every(function(t){return 1==t.is_select});$(".allCheck").prop("checked",t),0<this.selectData.length?(t=this.selectData.reduce(function(t,e,a){return t+e.salePrice*e.num},0),$("tfoot .amount").html(t.toFixed(2))):$("tfoot .amount").html(0)}},{key:"increasement",value:function(){var e=this,a=this.data.find(function(t){return t.productId==e.id}).num;$.ajax({url:"../data/updateCart.php",method:"post",data:{username:this.username,productId:this.id,num:++a},dataType:"json",success:function(t){var e=this;t.code&&(this.data.find(function(t){return t.productId==e.id}).num=a,this.renderCart())},error:function(t){console.log(t)},context:this})}},{key:"decrease",value:function(){var e=this,a=this.data.find(function(t){return t.productId==e.id}).num;a<=1?alert("商品最小数量为1"):$.ajax({url:"../data/updateCart.php",method:"post",data:{username:this.username,productId:this.id,num:--a},dataType:"json",success:function(t){var e=this;t.code&&(this.data.find(function(t){return t.productId==e.id}).num=a,this.renderCart())},error:function(t){console.log(t)},context:this})}},{key:"remove",value:function(e){$.ajax({url:"../data/deleteCart.php",method:"post",dataType:"json",data:{username:this.username,productId:e},success:function(t){console.log(t),t.code&&(this.data=this.data.filter(function(t){return t.productId!=e}),this.renderCart())},error:function(t){console.log(t)},context:this})}}]),a}();new Cart("#cart",login);